# Automatically generated by apkbuild-cpan, template 2
# Contributor: xoroxwb <xoroxwb@github.com>
# Maintainer: xoroxwb <xoroxwb@github.com>
pkgname=perl-lms-ev
_pkgreal=EV
pkgver=4.03
pkgrel=0
pkgdesc="Perl module for EV"
url="https://metacpan.org/release/EV/"
arch="all"
license="GPL-1.0-or-later Artistic-1.0-Perl"
depends="perl"
makedepends="perl-dev rsync perl-canary-stability perl-common-sense"
checkdepends=""
subpackages=""
source="https://github.com/Logitech/slimserver-vendor/raw/public/8.0/CPAN/$_pkgreal-$pkgver.tar.gz"
builddir="$srcdir/$_pkgreal-$pkgver"

build() {
		export _perlver=$(perl -MConfig -le '$Config{version} =~ /(\d+.\d+)\./; print $1')
    	export PERL5LIB="/usr/share/lms/CPAN/arch/$_perlver"
		export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
		PERL_MM_USE_DEFAULT=1 perl -I. Makefile.PL INSTALLDIRS=vendor
		make
}

check() {
        export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
        make test
}

package() {
		mkdir -p "$builddir"/abuild \
				"$pkgdir"/usr/share/lms/CPAN/arch/$_perlver

		make DESTDIR="$builddir/abuild" install

		rsync -amv \
				--include='*/' \
				--include='*.so' \
				--include='*.bundle' \
				--include='autosplit.ix' \
				--exclude='MakeMaker.pm' \
				--include='*.pm' \
				--include='*.al' \
				--exclude='*' \
				"$builddir"/abuild/usr/*/perl5/vendor_perl/ \
				"$pkgdir"/usr/share/lms/CPAN/arch/$_perlver/

		find "$pkgdir" \( -name perllocal.pod -o -name .packlist \) -delete
}

sha512sums="fecf2014e89c37ca90d61e432d4020b4c59af3877e1c423693f4a86ed0c66325053737ad1c4e20c2c85b1ca65717c811f54fc596da32a853ad142bd7f60c8e03  EV-4.03.tar.gz"
