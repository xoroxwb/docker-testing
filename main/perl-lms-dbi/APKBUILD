# Automatically generated by apkbuild-cpan, template 2
# Contributor: xoroxwb <xoroxwb@github.com>
# Maintainer: xoroxwb <xoroxwb@github.com>
pkgname=perl-lms-dbi
_pkgreal=DBI
pkgver=1.628
pkgrel=0
pkgdesc="Database independent interface for Perl"
url="https://metacpan.org/release/DBI/"
arch="all"
license="GPL-1.0-or-later OR Artistic-1.0-Perl"
depends="perl"
makedepends="perl-dev rsync"
checkdepends="perl-test-pod-coverage"
subpackages="$pkgname-dev"
source="https://github.com/Logitech/slimserver-vendor/raw/public/8.0/CPAN/$_pkgreal-$pkgver.tar.gz"
builddir="$srcdir/$_pkgreal-$pkgver"

build() {
		export _perlver=$(perl -MConfig -le '$Config{version} =~ /(\d+.\d+)\./; print $1')
    	export PERL5LIB="/usr/share/lms/CPAN/arch/$_perlver"
		export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
		PERL_MM_USE_DEFAULT=1 perl -I. Makefile.PL INSTALLDIRS=vendor
		make
}

check() {
        export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
        make test
}

package() {
		mkdir -p "$builddir"/abuild \
				"$pkgdir"/usr/share/lms/CPAN/arch/$_perlver

		make DESTDIR="$builddir/abuild" install

		rsync -amv \
				--include='*/' \
				--include='*.so' \
				--include='*.bundle' \
				--include='autosplit.ix' \
				--exclude='MakeMaker.pm' \
				--exclude='DBIODBC.pm' \
				--exclude='Bundle' \
				--include='*.pm' \
				--include='*.al' \
				--include='*.h' \
				--include='*.x' \
				--exclude='*' \
    			"$builddir"/abuild/usr/*/perl5/vendor_perl/ \
				"$pkgdir"/usr/share/lms/CPAN/arch/$_perlver/

		find "$pkgdir" \( -name perllocal.pod -o -name .packlist \) -delete
}

dev() {
	install -Dm644 \
		    "$builddir"/abuild/usr/lib/perl5/vendor_perl/auto/DBI/Driver.xst \
		   	"$subpkgdir"/usr/share/lms/CPAN/arch/$_perlver/auto/DBI/Driver.xst
	
	default_dev
}

sha512sums="34bb50ba7c0364e064fd5a05ea5415e43e40d082ed299503beccf2cba7b2ddd8f1e79e96606f35f9da279175ac16531da96d3762a71e9e63570f6db7b683f3a1  DBI-1.628.tar.gz"
