# Automatically generated by apkbuild-cpan, template 2
# Contributor: xoroxwb <xoroxwb@github.com>
# Maintainer: xoroxwb <xoroxwb@github.com>
pkgname=perl-lms-dbd-sqlite
_pkgreal=DBD-SQLite
pkgver=1.58
pkgrel=0
pkgdesc="Self Contained SQLite RDBMS in a DBI Driver"
url="https://metacpan.org/release/DBD-SQLite/"
arch="all"
license="GPL-1.0-or-later OR Artistic-1.0-Perl"
depends="perl perl-lms-dbi"
makedepends="perl-dev rsync perl-lms-dbi-dev lms-dev-icu"
checkdepends=""
subpackages=""
source="https://github.com/Logitech/slimserver-vendor/raw/public/8.0/CPAN/$_pkgreal-$pkgver.tar.gz
		DBD-SQLite-ICU.patch"
builddir="$srcdir/$_pkgreal-$pkgver"

build() {
		export _perlver=$(perl -MConfig -le '$Config{version} =~ /(\d+.\d+)\./; print $1')
		export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
    	export PERL5LIB="/usr/share/lms/CPAN/arch/$_perlver"
		export ICU_DATA="/usr/share/lms/dev/share/icu/58.2"
		PERL_MM_USE_DEFAULT=1 perl -I. Makefile.PL INSTALLDIRS=vendor
		make
}

check() {
        export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
        make test
}

package() {
		mkdir -p "$builddir"/abuild \
				"$pkgdir"/usr/share/lms/CPAN/arch/$_perlver

		make DESTDIR="$builddir/abuild" install

		rsync -amv \
				--include='*/' \
				--include='*.so' \
				--include='*.bundle' \
				--include='autosplit.ix' \
				--exclude='MakeMaker.pm' \
				--include='*.pm' \
				--include='*.al' \
				--exclude='*' \
				"$builddir"/abuild/usr/*/perl5/vendor_perl/ \
				"$pkgdir"/usr/share/lms/CPAN/arch/$_perlver/

		find "$pkgdir" \( -name perllocal.pod -o -name .packlist \) -delete
}

sha512sums="080d1e304fb0d43926ce0345df3367132c317ba113bdc11952c0a159bc68d988a024828a28e66be267f82e07731dee225723854fb80914ba7c476b27dbdeb212  DBD-SQLite-1.58.tar.gz
0ffbdf9832f3bc242cc398addea060986f258f505cac5d06e2b01dcd0905ffdccf46beca7eb9d4432d97c1e29f59a0f2b54b417508f1e1acacb0e5f10105fdfe  DBD-SQLite-ICU.patch"
